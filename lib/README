# Grundlage

A minimal, zero-dependency library for building web components with tagged template literals.

## Concepts

### Components as Generators

Components are defined using generator functions. This gives you explicit control over the component lifecycle: setup runs until you yield a render function, and the return value is your cleanup.

```javascript
import { render, html } from "grundlage";

render("my-counter", function* (props, ctx) {
	// Setup phase
	let count = 0;

	const increment = () => {
		count++;
		ctx.update();
	};

	// Yield a render function - component is now mounted
	yield () => html` <button onClick=${increment}>${count}</button> `;

	// Cleanup phase (returned function runs on disconnect)
	return () => {
		console.log("unmounted");
	};
});
```

### Templating

The `html` tagged template literal parses your markup once and caches the result. Subsequent renders only update the dynamic parts.

```javascript
html`<div class="card ${isActive ? "active" : ""}">
	<h2>${title}</h2>
	<p>${description}</p>
</div>`;
```

Supported bindings:

- Content: `<p>${text}</p>`
- Attributes: `<div class=${className}>`
- Mixed attributes: `<div class="static ${dynamic}">`
- Event handlers: `<button onClick=${handler}>`
- Lists: `<ul>${items.map(i => html`<li>${i}</li>`)}</ul>`
- Nested templates: `<div>${showDetails ? html`<details>...</details>` : null}</div>`
- Dynamic tags: `<${tagName}>content</${tagName}>`
- Raw content (style/script/textarea): `<style>${css}</style>`

### Reactivity

Grundlage uses a hash-based change detection system. When you call `ctx.update()`, it compares hashes of each expression to determine what actually changed.

This means:

- Primitives are compared by value
- Arrays and objects are compared by content (shallow)
- Nested templates are compared by structure and values
- DOM updates only happen for expressions that changed

```javascript
render("todo-list", function* (props, ctx) {
	const items = [];

	const add = (text) => {
		items.push({ id: Date.now(), text });
		ctx.update();
	};

	yield () => html`
		<ul>
			${items.map((item) => html`<li>${item.text}</li>`)}
		</ul>
	`;
});
```

### Web Components

Components are registered as custom elements. Use them in HTML or within other templates:

```html
<my-counter></my-counter>
```

```javascript
html`<my-counter initial=${5}></my-counter>`;
```

Props are passed as attributes and available in the generator's first argument.

## Installation

```bash
npm install grundlage
```

## Status

Experimental. API may change.
